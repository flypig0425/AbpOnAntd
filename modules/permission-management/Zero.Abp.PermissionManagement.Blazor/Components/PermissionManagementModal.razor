@using Microsoft.Extensions.Localization
@using Volo.Abp.PermissionManagement.Localization
@using Zero.Abp.AspNetCore.Components
@inherits AbpComponentBase

<Modal Visible="@_modalVisible" Centered
       Title="@($"{L["Permissions"]} - {_entityDisplayName}")"
       OkText="@L["Save"].Value"
       CancelText="@L["Cancel"].Value"
       OnOk="SaveAsync"
       OnCancel="CloseModal"
ConfirmLoading="ConfirmLoading">
    <Checkbox @bind-Checked="@GrantAll">@L["SelectAllInAllTabs"]</Checkbox>
    <Divider />
    @if (_groups != null)
    {
        <Tabs TabPosition="TabPosition.Left" @bind-ActiveKey="@_selectedTabName">
            @foreach (var group in _groups)
            {
                <TabPane Key="@GetNormalizedGroupName(group.Name)">
                    <TabTemplate>
                        @if (group.Permissions.Any(x => x.IsGranted))
                        {
                            <span>
                                <b>@group.DisplayName ( @(group.Permissions.Count(x => x.IsGranted)) )</b>
                            </span>
                        }
                        else
                        {
                            <b>  @group.DisplayName</b>
                        }
                    </TabTemplate>
                    <ChildContent>
                        <h4>@group.DisplayName</h4>
                        <Divider />
                        <Checkbox Checked="@(group.Permissions.All(x => x.IsGranted))"
                          OnChange="@(b => GroupGrantAllChanged(b, group))">
                            @L["SelectAllInThisTab"]
                        </Checkbox>
                        <Divider />

                        @foreach (var permission in group.Permissions)
                        {
                            <div style="@(permission.ParentName != null ?"margin: 1rem !important;":"")">
                                <Checkbox Checked="@permission.IsGranted"
                              OnChange="@(b => PermissionChanged(b, group, permission))"
                              Disabled="@(IsDisabledPermission(permission))">
                                    @GetShownName(permission)
                                </Checkbox>
                            </div>
                        }
                    </ChildContent>
                </TabPane>
            }
        </Tabs>
    }
</Modal>
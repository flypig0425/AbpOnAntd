@namespace Zero.Abp.AntdesignUI.Layout
@inherits AntLayoutComponentBase

@if (needFixedHeader)
{
    <Header Style="@FixedHeaderStyle" />
}
<Header Style="@HeaderStyle"
        Class="@HeaderClass">
    @if ((isTop || isSplitMenus) && !IsMobile)
    {
        <TopNavHeader Mode="MenuMode.Horizontal" MenuData="MenuData"
                  SelectedKeys="SelectedKeys" SelectedKeysChanged="SelectedKeysChanged" />
    }
    else
    {
        <GlobalHeader> @HeaderContentRender  </GlobalHeader>
    }
</Header>

@code {

    [Parameter] public ApplicationMenuItemList MenuData { get; set; }
    [Parameter] public string[] SelectedKeys { get; set; } = null;
    [Parameter] public EventCallback<string[]> SelectedKeysChanged { get; set; }

    [Parameter] public int SiderWidth { get; set; } = 208;
    [Parameter] public bool Collapsed { get; set; }
    [Parameter] public bool IsMobile { get; set; }
    [Parameter] public bool HasSiderMenu { get; set; }
    [Parameter] public RenderFragment HeaderContentRender { get; set; }

    private bool isSplitMenus => Settings.Layout == Layout.Mix.Name && Settings.SplitMenus;
    private bool isTop => Settings.Layout == Layout.Top.Name;
    private bool needFixedHeader => Settings.FixedHeader || Settings.Layout == Layout.Mix.Name;
    private int headerHeight => Settings.HeaderHeight;

    private bool needSettingWidth => needFixedHeader && HasSiderMenu && !isTop && !IsMobile;
    private string headerWidth => Settings.Layout != Layout.Mix.Name && needSettingWidth
      ? $"calc(100% - {(Collapsed ? 48 : SiderWidth)}px)" : "100%";
    private int? headerRight => needFixedHeader ? 0 : null;

    private string HeaderClass => ClassNames(
         ($"{PrefixCls}-fixed-header", needFixedHeader)
       , ($"{PrefixCls}-fixed-header-action", !Collapsed)
       , ($"{PrefixCls}-top-menu", Settings.Layout == Layout.Top.Name)
       , ($"{PrefixCls}-header-{Settings.HeaderTheme}")
        );

    private string FixedHeaderStyle =>
    $"height:{headerHeight}px;line-height:{headerHeight}px;background:transparent";

    private string HeaderStyle =>
    $"padding:0px;height:{headerHeight}px;line-height:{headerHeight}px;width:{headerWidth};z-index:{(Settings.Layout == Layout.Mix.Name ? 100 : 9)};{(headerRight.HasValue ? $"right:{headerRight}px;" : "")}{Style}";
}